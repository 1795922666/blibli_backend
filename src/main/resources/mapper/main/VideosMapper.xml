<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zspt.blibli.main.mapper.VideosMapper">

    <select id="recommend" resultType="com.zspt.blibli.main.controller.vo.VideoList">
        SELECT
            v.video_id, user_id, title, cover_url, category_id, tags, view_count, danmaku_count,publish_time,
            u.nick_name AS 用户名,
            vf.duration AS 视频时长
        FROM bli_videos v
                 LEFT JOIN bli_user u ON v.user_id = u.id
                 LEFT JOIN bli_videos_files vf ON v.video_id = vf.video_id
        WHERE
            v.STATUS = 0
    </select>
    <select id="getVideosInfo" resultType="com.zspt.blibli.main.controller.vo.VideoInfo">
        SELECT
            v.*,
            vf.file_url,
            (SELECT COUNT(*) FROM bli_comment WHERE video_id = v.video_id AND status = 1) AS commentCount,
            (SELECT COUNT(*) FROM bli_video_collect WHERE video_id = v.video_id AND status = 1) AS collectCount,
            (SELECT COALESCE(SUM(coin_count), 0) FROM bli_video_coin WHERE video_id = v.video_id) AS coinCount
        FROM
            bli_videos v
                LEFT JOIN bli_videos_files vf ON v.video_id = vf.video_id
        WHERE v.video_id =#{videoId};
    </select>
    <select id="getVideoList" resultType="com.zspt.blibli.main.controller.vo.VideoList">
        SELECT
            v.video_id, user_id, title, cover_url, category_id, tags, view_count, danmaku_count,publish_time,
            u.nick_name AS 用户名,
            vf.duration AS 视频时长
        FROM bli_videos v
                 LEFT JOIN bli_user u ON v.user_id = u.id
                 LEFT JOIN bli_videos_files vf ON v.video_id = vf.video_id
        WHERE
            v.user_id=#{userId} AND v.STATUS = 0

    </select>

</mapper>
